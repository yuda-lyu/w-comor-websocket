/*!
 * w-comor-websocket-client v1.0.36
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ws")):"function"==typeof define&&define.amd?define(["ws"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-comor-websocket-client"]=e(t.ws)}(this,(function(t){"use strict";function e(){return"undefined"!=typeof window&&void 0!==window.document}function n(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function r(r){let o=null;r.url||(r.url="ws://localhost:8080"),r.token||(r.token="*");let i,u=function(){let t=e(),n="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;return t=t||n,{isBrowser:t,isWebWorker:n,isNode:"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node}}().isBrowser;i=u?("undefined"!=typeof self?self:e()?window:"undefined"!=typeof global?global:null).WebSocket:t;try{o=new i(r.url+"/?token="+r.token)}catch(t){o=null}if(null===o)return{error:"can not new MixWS"};function c(){n(r.open)&&r.open()}function a(){n(r.close)&&r.close()}function s(t){n(r.message)&&r.message(t)}function f(t){n(r.error)&&r.error(t),o.close()}return u?(o.onopen=c,o.onmessage=function(t){s(t.data)},o.onclose=a,o.onerror=f):(o.on("open",c),o.on("message",s),o.on("close",a),o.on("error",f)),o}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i=Array.isArray,u="object"==typeof o&&o&&o.Object===Object&&o,c="object"==typeof self&&self&&self.Object===Object&&self,a=u||c||Function("return this")(),s=a.Symbol,f=s,l=Object.prototype,p=l.hasOwnProperty,v=l.toString,h=f?f.toStringTag:void 0;var y=function(t){var e=p.call(t,h),n=t[h];try{t[h]=void 0;var r=!0}catch(t){}var o=v.call(t);return r&&(e?t[h]=n:delete t[h]),o},_=Object.prototype.toString;var d=y,b=function(t){return _.call(t)},g=s?s.toStringTag:void 0;var w=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":g&&g in Object(t)?d(t):b(t)};var m=w,j=function(t){return null!=t&&"object"==typeof t};var O=function(t){return"symbol"==typeof t||j(t)&&"[object Symbol]"==m(t)},x=i,S=O,k=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,N=/^\w*$/;var P=function(t,e){if(x(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!S(t))||(N.test(t)||!k.test(t)||null!=e&&t in Object(e))};var A=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},z=w,$=A;var T,C=function(t){if(!$(t))return!1;var e=z(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},F=a["__core-js_shared__"],E=(T=/[^.]+$/.exec(F&&F.keys&&F.keys.IE_PROTO||""))?"Symbol(src)_1."+T:"";var L=function(t){return!!E&&E in t},W=Function.prototype.toString;var M=C,I=L,B=A,G=function(t){if(null!=t){try{return W.call(t)}catch(t){}try{return t+""}catch(t){}}return""},J=/^\[object .+?Constructor\]$/,R=Function.prototype,q=Object.prototype,U=R.toString,D=q.hasOwnProperty,H=RegExp("^"+U.call(D).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var K=function(t){return!(!B(t)||I(t))&&(M(t)?H:J).test(G(t))},Q=function(t,e){return null==t?void 0:t[e]};var V=function(t,e){var n=Q(t,e);return K(n)?n:void 0},X=V(Object,"create"),Y=X;var Z=function(){this.__data__=Y?Y(null):{},this.size=0};var tt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},et=X,nt=Object.prototype.hasOwnProperty;var rt=function(t){var e=this.__data__;if(et){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return nt.call(e,t)?e[t]:void 0},ot=X,it=Object.prototype.hasOwnProperty;var ut=X;var ct=Z,at=tt,st=rt,ft=function(t){var e=this.__data__;return ot?void 0!==e[t]:it.call(e,t)},lt=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ut&&void 0===e?"__lodash_hash_undefined__":e,this};function pt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}pt.prototype.clear=ct,pt.prototype.delete=at,pt.prototype.get=st,pt.prototype.has=ft,pt.prototype.set=lt;var vt=pt;var ht=function(){this.__data__=[],this.size=0};var yt=function(t,e){return t===e||t!=t&&e!=e},_t=yt;var dt=function(t,e){for(var n=t.length;n--;)if(_t(t[n][0],e))return n;return-1},bt=dt,gt=Array.prototype.splice;var wt=dt;var mt=dt;var jt=dt;var Ot=ht,xt=function(t){var e=this.__data__,n=bt(e,t);return!(n<0)&&(n==e.length-1?e.pop():gt.call(e,n,1),--this.size,!0)},St=function(t){var e=this.__data__,n=wt(e,t);return n<0?void 0:e[n][1]},kt=function(t){return mt(this.__data__,t)>-1},Nt=function(t,e){var n=this.__data__,r=jt(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function Pt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Pt.prototype.clear=Ot,Pt.prototype.delete=xt,Pt.prototype.get=St,Pt.prototype.has=kt,Pt.prototype.set=Nt;var At=Pt,zt=V(a,"Map"),$t=vt,Tt=At,Ct=zt;var Ft=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Et=function(t,e){var n=t.__data__;return Ft(e)?n["string"==typeof e?"string":"hash"]:n.map},Lt=Et;var Wt=Et;var Mt=Et;var It=Et;var Bt=function(){this.size=0,this.__data__={hash:new $t,map:new(Ct||Tt),string:new $t}},Gt=function(t){var e=Lt(this,t).delete(t);return this.size-=e?1:0,e},Jt=function(t){return Wt(this,t).get(t)},Rt=function(t){return Mt(this,t).has(t)},qt=function(t,e){var n=It(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function Ut(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ut.prototype.clear=Bt,Ut.prototype.delete=Gt,Ut.prototype.get=Jt,Ut.prototype.has=Rt,Ut.prototype.set=qt;var Dt=Ut;function Ht(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var u=t.apply(this,r);return n.cache=i.set(o,u)||i,u};return n.cache=new(Ht.Cache||Dt),n}Ht.Cache=Dt;var Kt=Ht;var Qt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Vt=/\\(\\)?/g,Xt=function(t){var e=Kt(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Qt,(function(t,n,r,o){e.push(r?o.replace(Vt,"$1"):n||t)})),e}));var Yt=function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o},Zt=i,te=O,ee=s?s.prototype:void 0,ne=ee?ee.toString:void 0;var re=function t(e){if("string"==typeof e)return e;if(Zt(e))return Yt(e,t)+"";if(te(e))return ne?ne.call(e):"";var n=e+"";return"0"==n&&1/e==-Infinity?"-0":n},oe=re;var ie=function(t){return null==t?"":oe(t)},ue=i,ce=P,ae=Xt,se=ie;var fe=function(t,e){return ue(t)?t:ce(t,e)?[t]:ae(se(t))},le=O;var pe=function(t){if("string"==typeof t||le(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},ve=fe,he=pe;var ye=function(t,e){for(var n=0,r=(e=ve(e,t)).length;null!=t&&n<r;)t=t[he(e[n++])];return n&&n==r?t:void 0};var _e=function(t,e,n){var r=null==t?void 0:ye(t,e);return void 0===r?n:r},de=V,be=function(){try{var t=de(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var ge=function(t,e,n){"__proto__"==e&&be?be(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},we=yt,me=Object.prototype.hasOwnProperty;var je=/^(?:0|[1-9]\d*)$/;var Oe=function(t,e,n){var r=t[e];me.call(t,e)&&we(r,n)&&(void 0!==n||e in t)||ge(t,e,n)},xe=fe,Se=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&je.test(t))&&t>-1&&t%1==0&&t<e},ke=A,Ne=pe;var Pe=function(t,e,n,r){if(!ke(t))return t;for(var o=-1,i=(e=xe(e,t)).length,u=i-1,c=t;null!=c&&++o<i;){var a=Ne(e[o]),s=n;if("__proto__"===a||"constructor"===a||"prototype"===a)return t;if(o!=u){var f=c[a];void 0===(s=r?r(f,a,c):void 0)&&(s=ke(f)?f:Se(e[o+1])?[]:{})}Oe(c,a,s),c=c[a]}return t};var Ae=function(t,e,n){return null==t?t:Pe(t,e,n)};function ze(){let t,e,n=new Promise((function(){t=arguments[0],e=arguments[1]}));return n.resolve=t,n.reject=e,n}var $e=/\s/;var Te=function(t){for(var e=t.length;e--&&$e.test(t.charAt(e)););return e},Ce=/^\s+/;var Fe=function(t){return t?t.slice(0,Te(t)+1).replace(Ce,""):t},Ee=A,Le=O,We=/^[-+]0x[0-9a-f]+$/i,Me=/^0b[01]+$/i,Ie=/^0o[0-7]+$/i,Be=parseInt;var Ge=function(t){if("number"==typeof t)return t;if(Le(t))return NaN;if(Ee(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Ee(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Fe(t);var n=Me.test(t);return n||Ie.test(t)?Be(t.slice(2),n?2:8):We.test(t)?NaN:+t},Je=Ge,Re=1/0;var qe=function(t){return t?(t=Je(t))===Re||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},Ue=qe;var De=function(t){var e=Ue(t),n=e%1;return e==e?n?e-n:e:0},He=De;var Ke=function(t){return"number"==typeof t&&t==He(t)};function Qe(t){return!(!function(t){return"[object String]"===Object.prototype.toString.call(t)}(t)||""===t)}function Ve(t){let e=!1;return Qe(t)?e=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(e=!0),e}function Xe(t){if(!Ve(t))return 0;return qe(t)}var Ye=De,Ze=Ge,tn=ie,en=a.isFinite,nn=Math.min;var rn=function(t){var e=Math[t];return function(t,n){if(t=Ze(t),(n=null==n?0:nn(Ye(n),292))&&en(t)){var r=(tn(t)+"e").split("e"),o=e(r[0]+"e"+(+r[1]+n));return+((r=(tn(o)+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round");function on(t){if(!Ve(t))return 0;t=Xe(t);let e=rn(t);return"0"===String(e)?0:e}function un(t){if(!function(t){return!!Ve(t)&&(t=Xe(t),Ke(t))}(t))return!1;return on(t)>0}let cn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),an=cn.length;var sn={};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,r,i,u){if("function"!=typeof r)throw new TypeError("The listener must be a function");var c=new o(r,i||t,u),a=n?n+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],c]:t._events[a].push(c):(t._events[a]=c,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function c(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),c.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},c.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,u=new Array(i);o<i;o++)u[o]=r[o].fn;return u},c.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},c.prototype.emit=function(t,e,r,o,i,u){var c=n?n+t:t;if(!this._events[c])return!1;var a,s,f=this._events[c],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,r),!0;case 4:return f.fn.call(f.context,e,r,o),!0;case 5:return f.fn.call(f.context,e,r,o,i),!0;case 6:return f.fn.call(f.context,e,r,o,i,u),!0}for(s=1,a=new Array(l-1);s<l;s++)a[s-1]=arguments[s];f.fn.apply(f.context,a)}else{var p,v=f.length;for(s=0;s<v;s++)switch(f[s].once&&this.removeListener(t,f[s].fn,void 0,!0),l){case 1:f[s].fn.call(f[s].context);break;case 2:f[s].fn.call(f[s].context,e);break;case 3:f[s].fn.call(f[s].context,e,r);break;case 4:f[s].fn.call(f[s].context,e,r,o);break;default:if(!a)for(p=1,a=new Array(l-1);p<l;p++)a[p-1]=arguments[p];f[s].fn.apply(f[s].context,a)}}return!0},c.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,r,o){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return u(this,i),this;var c=this._events[i];if(c.fn)c.fn!==e||o&&!c.once||r&&c.context!==r||u(this,i);else{for(var a=0,s=[],f=c.length;a<f;a++)(c[a].fn!==e||o&&!c[a].once||r&&c[a].context!==r)&&s.push(c[a]);s.length?this._events[i]=1===s.length?s[0]:s:u(this,i)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&u(this,e)):(this._events=new r,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,t.exports=c}({get exports(){return sn},set exports(t){sn=t}});var fn=sn;function ln(){return new fn}return function(t){let o=ze(),i=null,u={},c=new ln,a=e()?"browser":"nodejs";function s(){let e={url:null,token:null,open:function(){!function(){n(t.open)&&t.open();s("getFuncs",null)}()},close:function(){!function(){n(t.close)&&t.close();f()}()},message:function(t){!function(t){"browser"===a||(t=Buffer.from(t).toString("utf8"));let e=function(t){if(!Qe(t))return{};let e={};try{e=JSON.parse(t)}catch(t){e={}}return e}(t);if("sys"===_e(e,"output.sys")&&_e(e,"output.funcs")){let t=e.output.funcs;u={};for(let e=0;e<t.length;e++){let n=t[e];Ae(u,n,(function(t){return s(n,t)}))}o.resolve(u)}if(_e(e,"_id")&&_e(e,"output")){let t=_e(e,"_id"),n=_e(e,"output");c.emit(t,n)}}(t)},error:function(e){!function(e){n(t.error)&&t.error(e);i.close()}(e)}};t.url||(e.url="ws://localhost:8080"),t.token||(e.token="*");try{i=new r(e)}catch(t){return f(),null}if(_e(i,"error"))return f(),null;function s(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=ze(),u=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];t=un(t)?on(t):32;for(let n=0;n<t;n++)e[n]=cn[0|Math.random()*an];return e.join("")}(),a={token:t.token,_id:u,func:e,input:r};return i.readyState===i.OPEN&&i.send(JSON.stringify(a),(function(e){e&&n(t.error)&&t.error(e)})),c.on(u,(function(t){o.resolve(t),c.removeAllListeners(u)})),o}}function f(){setTimeout((function(){n(t.reconn)&&t.reconn(),s()}),1e3)}return s(),o}}));
//# sourceMappingURL=w-comor-websocket-client.umd.js.map
